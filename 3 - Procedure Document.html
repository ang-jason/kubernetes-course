<h4><strong>Kubernetes Procedure Document</strong></h4><h4>Github repository [Read this first]</h4><ul><li><p>Download all the course material from: <a href="https://github.com/wardviaene/kubernetes-course" rel="noopener noreferrer" target="_blank">https://github.com/wardviaene/kubernetes-course</a></p></li><li><p>Kubernetes releases minor version updates of its distribution every 3 months</p><ul><li><p>Rather than updating the scripts in the video lectures, <strong>the repository in Github is updated if any script need changes</strong></p></li><li><p>The changes are often very minor, the API is very stable. Often API versions like v1betaX change to v1betaX+1 or to v1 (stable)</p></li><li><p>All the scripts you can find in the repository <strong>should work with the latest version of Kubernetes</strong>, if you have any issues, contact me through one of the channels listed below</p></li></ul></li></ul><h4>Kubernetes setup lectures</h4><p>There are multiple ways to setup a kubernetes cluster.&nbsp;You only need 1 working cluster to do the demos, but I've added different ways that you can create your cluster.</p><ul><li><p>A local cluster (on your machine):&nbsp;you can follow the minikube or docker for windows/mac lectures</p></li><li><p>A&nbsp;production cluster using Kops on AWS</p></li><li><p>A&nbsp;on-prem or cloud-agnostic cluster using kubeadm (lecture is at the end of the course)</p></li><li><p>A&nbsp;managed production cluster on AWS using EKS&nbsp;(lecture can also be found at the end of the course)</p></li></ul><p>If you want to test all features, kops is the best choice. If you want to have a local cluster, try out minikube first. If you have issues getting minikube up, docker for windows/mac comes with kubernetes and is a great alternative.</p><p>Kops gives you full access to the master nodes. To learn to work with Kubernetes, kops is preferred. If you have issues setting up kops, you can give EKS&nbsp;a try (lectures at the end of the course). EKS&nbsp;is more expensive than kops, so make sure to keep an eye on your billing and destroy the cluster after you're done with testing/demos.</p><p>If you want to deploy a cluster on any cloud or on an on-prem machine, then kubeadm will be the way to go. If you want to use a cloud provider like Azure, Google, or DigitalOcean, that will also work. They all provide their own managed kubernetes solutions.</p><h4>Slides</h4><p>The slides can be downloaded from:&nbsp;<a href="https://d3jb1lt6v0nddd.cloudfront.net/udemy/Learn+DevOps+-+Kubernetes.pdf" rel="noopener noreferrer" target="_blank">https://d3jb1lt6v0nddd.cloudfront.net/udemy/Learn+DevOps+-+Kubernetes.pdf</a></p><h4>Questions?</h4><ul><li><p>Send me a message</p></li><li><p>Use Q&amp;A</p></li><li><p>Join our facebook group: <a href="https://www.facebook.com/groups/840062592768074/" rel="noopener noreferrer" target="_blank">https://www.facebook.com/groups/840062592768074/</a></p></li></ul><h4>Download Kubectl</h4><ul><li><p>Linux: <a href="https://storage.googleapis.com/kubernetes-release/release/v1.17.0/bin/linux/amd64/kubectl" rel="noopener noreferrer" target="_blank">https://storage.googleapis.com/kubernetes-release/release/v1.17.0/bin/linux/amd64/kubectl</a></p></li><li><p>MacOS: <a href="https://storage.googleapis.com/kubernetes-release/release/v1.17.0/bin/darwin/amd64/kubectl" rel="noopener noreferrer" target="_blank">https://storage.googleapis.com/kubernetes-release/release/v1.17.0/bin/darwin/amd64/kubectl</a></p></li><li><p>Windows: <a href="https://storage.googleapis.com/kubernetes-release/release/v1.17.0/bin/windows/amd64/kubectl.exe" rel="noopener noreferrer" target="_blank">https://storage.googleapis.com/kubernetes-release/release/v1.17.0/bin/windows/amd64/kubectl.exe</a></p></li><li><p>Or use a packaged version for your OS:&nbsp;see <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener noreferrer" target="_blank">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></p></li></ul><h4>Minikube</h4><ul><li><p>Project URL: https://github.com/kubernetes/minikube</p></li><li><p>Latest Release and download instructions: https://github.com/kubernetes/minikube/releases</p></li><li><p>VirtualBox: http://www.virtualbox.org</p></li></ul><h4>Minikube on windows:</h4><ul><li><p>Download the latest minikube-version.exe</p></li><li><p>Rename the file to minikube.exe and put it in C:\minikube</p></li><li><p>Open a cmd (search for the app cmd or powershell)</p></li><li><p>Run: cd C:\minikube and enter minikube start</p></li></ul><h4>Test your cluster commands</h4><p>Make sure your cluster is running, you can check with <strong>minikube status.</strong></p><p>If your cluster is not running, enter <strong>minikube start</strong> first.</p><p>Run the hello-minikube deployment:</p><pre class="prettyprint linenums">kubectl create deployment hello-minikube --image=k8s.gcr.io/echoserver:1.4
kubectl expose deployment hello-minikube --type=NodePort --port=8080</pre><p>then run:</p><p>minikube service hello-minikube --url</p><p>&lt;open a browser and go to that url&gt;</p><h4>Kops</h4><h4>Project URL</h4><ul><li><p><a href="https://github.com/kubernetes/kops" rel="noopener noreferrer" target="_blank">https://github.com/kubernetes/kops</a></p></li></ul><h4>Free DNS Service</h4><ul><li><p>Sign up at <a href="http://freedns.afraid.org/" rel="noopener noreferrer" target="_blank">http://freedns.afraid.org/</a></p><ul><li><p>Choose for subdomain hosting</p></li><li><p>Enter the AWS nameservers given to you in route53 as nameservers for the subdomain</p></li></ul></li><li><p><a href="http://www.dot.tk/" rel="noopener noreferrer" target="_blank">http://www.dot.tk/</a> provides a free .tk domain name you can use and you can point it to the amazon AWS nameservers</p></li><li><p>Namecheap.com often has promotions for tlds like .co for just a couple of bucks</p><p><br></p></li></ul><h4>Cluster Commands</h4><ul><li><p>kops create cluster --name=kubernetes.newtech.academy --state=s3://kops-state-b429b --zones=eu-west-1a --node-count=2 --node-size=t2.micro --master-size=t2.micro --dns-zone=kubernetes.newtech.academy</p></li><li><p>kops update cluster kubernetes.newtech.academy --yes --state=s3://kops-state-b429b</p></li><li><p>kops delete cluster --name kubernetes.newtech.academy --state=s3://kops-state-b429b</p></li><li><p>kops delete cluster --name kubernetes.newtech.academy --state=s3://kops-state-b429b --yes</p></li></ul><h4>Kubernetes from scratch<br></h4><ul><li><p>You can setup your cluster manually from scratch</p></li><li><p>If youre planning to deploy on AWS / Google / Azure, use the tools that are fit for these platforms</p></li><li><p>If you have an unsupported cloud platform, and you still want Kubernetes, you can install it manually</p></li><li><p>CoreOS + Kubernetes: ###a href="https://coreos.com/kubernetes/docs/latest/getting-started.html"&gt;https://coreos.com/kubernetes/docs/latest/getting-started.html</p></li></ul><h4>Docker</h4><ul><li><p>You can download Docker Engine for:</p><ul><li><p>Windows:<a href="https://docs.docker.com/engine/installation/windows/" rel="noopener noreferrer" target="_blank"> https://docs.docker.com/engine/installation/windows/</a></p></li><li><p>MacOS:<a href="https://docs.docker.com/engine/installation/mac/" rel="noopener noreferrer" target="_blank"> https://docs.docker.com/engine/installation/mac/</a></p></li><li><p>Linux:<a href="https://docs.docker.com/engine/installation/linux/" rel="noopener noreferrer" target="_blank"> https://docs.docker.com/engine/installation/linux/</a></p></li></ul></li></ul><h4>DevOps box</h4><ul><li><p>Virtualbox: <a href="http://www.virtualbox.org" rel="noopener noreferrer" target="_blank">http://www.virtualbox.org</a></p></li><li><p>Vagrant: <a href="http://www.vagrantup.com" rel="noopener noreferrer" target="_blank">http://www.vagrantup.com</a></p></li><li><p>DevOps box: <a href="https://github.com/wardviaene/devops-box" rel="noopener noreferrer" target="_blank">https://github.com/wardviaene/devops-box</a></p></li><li><p>Launch commands (in terminal / cmd / powershell):</p><ul><li><p>cd devops-box/</p></li><li><p>vagrant up</p></li></ul></li><li><p>Launch commands for a plain ubuntu box:</p><ul><li><p>mkdir ubuntu</p></li><li><p>vagrant init ubuntu/xenial64</p></li><li><p>vagrant up</p></li></ul></li></ul><h4>Cheatsheet: Docker commands </h4><p>Build image:&nbsp;docker build .</p><p>Build &amp; Tag:&nbsp;docker build -t wardviaene/k8s-demo:latest .</p><p>Tag image: docker tag imageid wardviaene/k8s-demo</p><p>Push image: docker push wardviaene/k8s-demo</p><p>List images:&nbsp;docker images</p><p>List all containers: docker ps -a</p><h4>Cheatsheet:&nbsp;Kubernetes commands</h4><p>kubectl get pod:&nbsp;Get information about all running pods</p><p>kubectl describe pod &lt;pod&gt;: Describe one pod</p><p>kubectl expose pod &lt;pod&gt; --port=444 --name=frontend:&nbsp;Expose the port of a pod (creates a new service)</p><p>kubectl port-forward &lt;pod&gt; 8080:&nbsp;Port forward the exposed pod port to your local machine</p><p>kubectl attach &lt;podname&gt; -i: Attach to the pod</p><p>kubectl exec &lt;pod&gt; -- command:&nbsp;Execute a command on the pod</p><p>kubectl label pods &lt;pod&gt; mylabel=awesome:&nbsp;Add a new label to a pod</p><p>kubectl run -i --tty busybox --image=busybox --restart=Never -- sh:&nbsp;Run a shell in a pod - very useful for debugging</p><p>kubectl get deployments:&nbsp;Get information on current deployments</p><p>kubectl get rs:&nbsp;Get information about the replica sets</p><p>kubectl get pods --show-labels:&nbsp;get pods, and also show labels attached to those pods</p><p>kubectl rollout status deployment/helloworld-deployment: Get deployment status</p><p>kubectl set image deployment/helloworld-deployment&nbsp;k8s-demo=k8s-demo:2: Run k8s-demo with the image label version 2</p><p>kubectl edit deployment/helloworld-deployment:&nbsp;Edit the deployment object</p><p>kubectl rollout status deployment/helloworld-deployment:&nbsp;Get the status of the rollout</p><p>kubectl rollout history deployment/helloworld-deployment: Get the rollout history</p><p>kubectl rollout undo deployment/helloworld-deployment:&nbsp;Rollback to previous version</p><p>kubectl rollout undo deployment/helloworld-deployment --to-revision=n: Rollback to any version version</p><h4>AWS Commands</h4><ul><li><p>aws ec2 create-volume --size 10 --region us-east-1 --availability-zone us-east-1a --volume-type gp2</p></li></ul><h4>Certificates</h4><ul><li><p>Creating a new key for a new user: openssl genrsa -out myuser.pem 2048</p></li><li><p>Creating a certificate request: openssl req -new -key myuser.pem -out myuser-csr.pem -subj "/CN=myuser/O=myteam/"</p></li><li><p>Creating a certificate: openssl x509 -req -in myuser-csr.pem -CA /path/to/kubernetes/ca.crt -CAkey /path/to/kubernetes/ca.key -CAcreateserial -out myuser.crt -days 10000</p></li></ul><h4>Abbreviations used</h4><p>Resource type: Abbreviated alias</p><p>configmaps: cm</p><p>customresourcedefinition: crd</p><p>daemonsets: ds</p><p>deployments deploy</p><p>horizontalpodautoscalers: hpa</p><p>ingresses ing</p><p>limitranges limits</p><p>namespaces: ns</p><p>nodes: no</p><p>persistentvolumeclaims: pvc</p><p>persistentvolumes: pv</p><p>pods: po</p><p>replicasets: rs</p><p>replicationcontrollers: rc</p><p>resourcequotas: quota</p><p>serviceaccounts: sa</p><p>services: svc</p>